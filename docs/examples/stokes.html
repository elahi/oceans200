<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>qk2e - QK Box 11.1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">qk2e</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../chapter_notes/chapter2.html" rel="" target="">
 <span class="menu-text">Chapter notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides/slides.html" rel="" target="">
 <span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../examples/low.html" rel="" target="" aria-current="page">
 <span class="menu-text">Examples</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../examples/stokes.html">QK Box 11.1</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/low.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 2.2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/lowboot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 2.3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/serpulid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 6.7 &amp; 6.11</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/linton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 7.1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/caballes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 10.6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/stokes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">QK Box 11.1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../examples/steiger.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">QK Box 12.1</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#fit-full-model-with-logttxweight" id="toc-fit-full-model-with-logttxweight" class="nav-link" data-scroll-target="#fit-full-model-with-logttxweight">Fit full model with log(ttxweight)</a>
  <ul class="collapse">
  <li><a href="#get-var-components-using-ols" id="toc-get-var-components-using-ols" class="nav-link" data-scroll-target="#get-var-components-using-ols">Get var components using OLS</a></li>
  </ul></li>
  <li><a href="#fit-mixed-effects-models-with-lmer" id="toc-fit-mixed-effects-models-with-lmer" class="nav-link" data-scroll-target="#fit-mixed-effects-models-with-lmer">Fit mixed effects models with lmer</a>
  <ul class="collapse">
  <li><a href="#contrast-head-vs-anterior-and-anterior-vs-posterior-segments" id="toc-contrast-head-vs-anterior-and-anterior-vs-posterior-segments" class="nav-link" data-scroll-target="#contrast-head-vs-anterior-and-anterior-vs-posterior-segments">Contrast head vs anterior and anterior vs posterior segments</a></li>
  <li><a href="#get-variance-components-with-cis" id="toc-get-variance-components-with-cis" class="nav-link" data-scroll-target="#get-variance-components-with-cis">Get variance components with CIs</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">QK Box 11.1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Stokes et al.&nbsp;(2014) studied the neurotoxin tetrodotoxin (TTX) in flatworms. The between-plots factor was flatworm species (fixed with two groups: <em>Bipalium adventitium</em> and <em>Bipalium kewense</em>) with individual flatworms (plots) nested within species. The within-plots factor was body segment (fixed with three groups: head, anterior body, posterior body) and each segment represented a “sub-plot”. The response variable was the TTX concentration of tissue adjusted for weight. The main research questions were about the fixed effects of species, body segment and their interaction on TTX concentration, but the analyses also provide information about the variances associated with the random effects of individual within species and the random interaction between individuals within species and body segment.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://commons.wikimedia.org/wiki/File:Bipalium_adventitium_(YPM_IZ_046916)_01.jpeg"><img src="../media/Bipalium_adventitium_(YPM_IZ_046916)_01.jpeg" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><em>Bipalium advenitium</em>. Yale Peabody Museum, <img src="../media/cc-zero.png" class="img-fluid" width="57">, via Wikimedia Commons</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://commons.wikimedia.org/wiki/File:Bipalium_kewense_Kauai.jpg"><img src="../media/Bipalium_kewense_Kauai.jpg" class="img-fluid figure-img"></a></p>
</figure>
</div>
<p><em>Bipalium kewense</em>. Don Loarie <a href="https://creativecommons.org/licenses/by/4.0"><img src="../media/by.png" class="img-fluid" width="57"></a>, via Wikimedia Commons</p>
<p>The data are <a href="https://doi.org/10.1371/journal.pone.0100718">here</a></p>
<p>Stokes, A. N., Ducey, P. K., Neuman-Lee, L., Hanifin, C. T., French, S. S., Pfrender, M. E., Brodie, E. D., 3rd &amp; Brodie, E. D., Jr.&nbsp;(2014). Confirmation and distribution of tetrodotoxin for the first time in terrestrial invertebrates: two terrestrial flatworm species (<em>Bipalium adventitium</em> and <em>Bipalium kewense</em>). <em>PLoS One</em>, 9, e100718.</p>
<section id="preliminaries" class="level3">
<h3 class="anchored" data-anchor-id="preliminaries">Preliminaries</h3>
<p>Packages:</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-1_4b61459fad5b9fd4f6115dee8125f4a6">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/set_ggplot_theme.R"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rmisc)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VCA)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(afex)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ez)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(apaTables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Import stokes data file (<a href="data/stokes.csv">stokes.csv</a>)</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-2_d7ebbc5d3819c8a51c271a2ed3cce1a2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>stokes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/stokes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualize data</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-3_08f4771455b276ea8fb3812c862503e2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>stokes <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(indiv, ttxweight, <span class="at">color =</span> species)) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> segment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Set contrasts from afex make individual a factor, make sure species a factor too put segments into sensible order</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-4_96478a9ba3f86bda1d21e9156ba34080">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_sum_contrasts</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>stokes<span class="sc">$</span>indiv <span class="ot">&lt;-</span> <span class="fu">factor</span>(stokes<span class="sc">$</span>indiv)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>stokes<span class="sc">$</span>species<span class="ot">&lt;-</span><span class="fu">factor</span>(stokes<span class="sc">$</span>species)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>stokes<span class="sc">$</span>segment <span class="ot">&lt;-</span> <span class="fu">factor</span>(stokes<span class="sc">$</span>segment, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"h"</span>,<span class="st">"b"</span>,<span class="st">"p"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check residuals by leaving out error term</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-5_5fa784e4d922ec52f58a40d79c134c54">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>stokes1.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(ttxweight<span class="sc">~</span>species<span class="sc">*</span>segment, stokes)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stokes1.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Wedge-shaped with mean-variance relationship - redo after log transform</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-6_5fde773f22ddc2f3275bbcd8d82779d1">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>stokes<span class="sc">$</span>lttxweight <span class="ot">&lt;-</span> <span class="fu">log10</span>(stokes<span class="sc">$</span>ttxweight)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>stokes2.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(lttxweight<span class="sc">~</span>species<span class="sc">*</span>segment, stokes)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stokes2.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualize log data</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-7_70fb6258898df57676f69a948b7648b4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>stokes <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(indiv, lttxweight, <span class="at">color =</span> species)) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> segment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fit-full-model-with-logttxweight" class="level2">
<h2 class="anchored" data-anchor-id="fit-full-model-with-logttxweight">Fit full model with log(ttxweight)</h2>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-8_a5e39d09ceb383cab94fbe14d604f8fa">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stokes3.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(lttxweight<span class="sc">~</span>species<span class="sc">*</span>segment<span class="sc">+</span><span class="fu">Error</span>(indiv), stokes)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stokes3.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Error: indiv
          Df Sum Sq Mean Sq F value Pr(&gt;F)  
species    1 0.8087  0.8087    6.17 0.0323 *
Residuals 10 1.3107  0.1311                 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Error: Within
                Df Sum Sq Mean Sq F value   Pr(&gt;F)    
segment          2 17.149   8.575  46.965 2.78e-08 ***
species:segment  2  0.074   0.037   0.202    0.819    
Residuals       20  3.652   0.183                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Use ez for comparison with type 3 SS - same result as design is balanced</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-10_edc387b5022fc934525df32816a8d65e">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ezstokes <span class="ot">&lt;-</span> <span class="fu">ezANOVA</span>(<span class="at">data=</span>stokes, <span class="at">dv=</span>lttxweight, <span class="at">wid=</span>indiv, <span class="at">within=</span>segment, <span class="at">between=</span>species, <span class="at">type=</span><span class="dv">3</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ezstokes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$ANOVA
           Effect DFn DFd          F            p p&lt;.05        ges
2         species   1  10  6.1699328 3.232426e-02     * 0.14012958
3         segment   2  20 46.9649253 2.779231e-08     * 0.77558408
4 species:segment   2  20  0.2021994 8.185815e-01       0.01466111

$`Mauchly's Test for Sphericity`
           Effect        W         p p&lt;.05
3         segment 0.719343 0.2270974      
4 species:segment 0.719343 0.2270974      

$`Sphericity Corrections`
           Effect       GGe        p[GG] p[GG]&lt;.05       HFe        p[HF]
3         segment 0.7808492 6.940839e-07         * 0.8993921 1.214771e-07
4 species:segment 0.7808492 7.654586e-01           0.8993921 7.963230e-01
  p[HF]&lt;.05
3         *
4          </code></pre>
</div>
</div>
<section id="get-var-components-using-ols" class="level3">
<h3 class="anchored" data-anchor-id="get-var-components-using-ols">Get var components using OLS</h3>
<p><strong>Note</strong> that these estimates treat B(A)*C as the residual for B(A) vc</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-11_9c8ebd4be096726f052512420fd1e4f9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>stokes2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(stokes)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>stokes.vca <span class="ot">&lt;-</span> <span class="fu">anovaMM</span>(lttxweight<span class="sc">~</span>species<span class="sc">/</span>(indiv)<span class="sc">+</span>segment<span class="sc">+</span>species<span class="sc">*</span>segment, <span class="at">NegVC=</span><span class="cn">TRUE</span>, stokes2)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>stokes.vca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

ANOVA-Type Estimation of Mixed Model:
--------------------------------------

    [Fixed Effects]

                         int          speciesBadventitium 
                   -0.385414                     0.326190 
             speciesBkewense                     segmentb 
                    0.000000                     0.272682 
                    segmenth                     segmentp 
                    1.667431                     0.000000 
speciesBadventitium:segmentb     speciesBkewense:segmentb 
                    0.068888                     0.000000 
speciesBadventitium:segmenth     speciesBkewense:segmenth 
                   -0.148197                     0.000000 
speciesBadventitium:segmentp     speciesBkewense:segmentp 
                    0.000000                     0.000000 


    [Variance Components]

  Name          DF        SS       MS       VC       %Total     SD      
1 total         29.367096                   0.165407 100        0.406702
2 species:indiv 10        1.310664 0.131066 -0.01717 -10.380622 0       
3 error         20        3.651543 0.182577 0.182577 110.380622 0.42729 
  CV[%]     
1 98.914014 
2 0         
3 103.921222

Mean: 0.411168 (N = 36) 

Experimental Design: balanced  |  Method: ANOVA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VCAinference</span>(stokes.vca, <span class="at">alpha=</span><span class="fl">0.05</span>, <span class="at">ci.method=</span><span class="st">"satterthwaite"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>


Inference from Mixed Model Fit
------------------------------

&gt; VCA Result:
-------------

    [Fixed Effects]

                         int          speciesBadventitium 
                     -0.3854                       0.3262 
             speciesBkewense                     segmentb 
                      0.0000                       0.2727 
                    segmenth                     segmentp 
                      1.6674                       0.0000 
speciesBadventitium:segmentb     speciesBkewense:segmentb 
                      0.0689                       0.0000 
speciesBadventitium:segmenth     speciesBkewense:segmenth 
                     -0.1482                       0.0000 
speciesBadventitium:segmentp     speciesBkewense:segmentp 
                      0.0000                       0.0000 


    [Variance Components]

  Name          DF      SS     MS     VC      %Total   SD     CV[%]   
1 total         29.3671               0.1654  100      0.4067 98.914  
2 species:indiv 10      1.3107 0.1311 -0.0172 -10.3806 0      0       
3 error         20      3.6515 0.1826 0.1826  110.3806 0.4273 103.9212

Mean: 0.4112 (N = 36) 

Experimental Design: balanced  |  Method: ANOVA


&gt; VC:
-----
              Estimate      DF CI LCL CI UCL One-Sided LCL One-Sided UCL
total           0.1654 29.3671 0.1052 0.2976        0.1130        0.2699
species:indiv  -0.0172  0.7840                                          
error           0.1826 20.0000 0.1069 0.3807        0.1163        0.3365

&gt; SD:
-----
              Estimate      DF CI LCL CI UCL One-Sided LCL One-Sided UCL
total           0.4067 29.3671 0.3243 0.5456        0.3361        0.5195
species:indiv   0.0000  0.7840                                          
error           0.4273 20.0000 0.3269 0.6170        0.3410        0.5801

&gt; CV[%]:
--------
              Estimate      DF  CI LCL   CI UCL One-Sided LCL One-Sided UCL
total          98.9140 29.3671 78.8754 132.6887       81.7401      126.3578
species:indiv   0.0000  0.7840                                             
error         103.9212 20.0000 79.5059 150.0695       82.9244      141.0874


95% Confidence Level  |  CIs for negative VCs excluded  
Satterthwaite methodology used for computing CIs </code></pre>
</div>
</div>
</section>
</section>
<section id="fit-mixed-effects-models-with-lmer" class="level2">
<h2 class="anchored" data-anchor-id="fit-mixed-effects-models-with-lmer">Fit mixed effects models with lmer</h2>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-12_44e732be08dca13f99c3c072e0b64be9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>stokes.lmer <span class="ot">&lt;-</span> <span class="fu">lmer</span>(lttxweight<span class="sc">~</span>species<span class="sc">+</span>segment<span class="sc">+</span>species<span class="sc">*</span>segment<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>indiv), <span class="at">REML=</span><span class="cn">TRUE</span>, stokes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check residuals from lmer plot</p>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-13_f9c9305915535630c56f70ad5563b766">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stokes.lmer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="stokes_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stokes.lmer, <span class="at">ddf=</span><span class="st">"Kenward-Roger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Kenward-Roger's method [
lmerModLmerTest]
Formula: lttxweight ~ species + segment + species * segment + (1 | indiv)
   Data: stokes

REML criterion at convergence: 41.9

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.81144 -0.39960  0.08694  0.72676  1.72771 

Random effects:
 Groups   Name        Variance Std.Dev.
 indiv    (Intercept) 0.0000   0.0000  
 Residual             0.1654   0.4067  
Number of obs: 36, groups:  indiv, 12

Fixed effects:
                         Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)                1.4600     0.1660 30.0000   8.793 8.36e-10 ***
speciesBkewense           -0.1780     0.2348 30.0000  -0.758    0.454    
segmentb                  -1.1777     0.2348 20.0000  -5.015 6.63e-05 ***
segmentp                  -1.5192     0.2348 20.0000  -6.470 2.62e-06 ***
speciesBkewense:segmentb  -0.2171     0.3321 20.0000  -0.654    0.521    
speciesBkewense:segmentp  -0.1482     0.3321 20.0000  -0.446    0.660    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                 (Intr) spcsBk sgmntb sgmntp spcsBkwns:sgmntb
specisBkwns      -0.707                                      
segmentb         -0.707  0.500                               
segmentp         -0.707  0.500  0.500                        
spcsBkwns:sgmntb  0.500 -0.707 -0.707 -0.354                 
spcsBkwns:sgmntp  0.500 -0.707 -0.354 -0.707  0.500          
optimizer (nloptwrap) convergence code: 0 (OK)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(stokes.lmer, <span class="at">ddf=</span><span class="st">"Kenward-Roger"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type III Analysis of Variance Table with Kenward-Roger's method
                 Sum Sq Mean Sq NumDF DenDF F value    Pr(&gt;F)    
species          0.8087  0.8087     1    10  4.8890   0.05146 .  
segment         17.1494  8.5747     2    20 51.8402 1.223e-08 ***
species:segment  0.0738  0.0369     2    20  0.2232   0.80193    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<section id="contrast-head-vs-anterior-and-anterior-vs-posterior-segments" class="level3">
<h3 class="anchored" data-anchor-id="contrast-head-vs-anterior-and-anterior-vs-posterior-segments">Contrast head vs anterior and anterior vs posterior segments</h3>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-14_792008e9220b90255cf02ffead2119df">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>stokes.emm <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(stokes.lmer, <span class="sc">~</span>segment)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>stokes.con <span class="ot">&lt;-</span> <span class="fu">contrast</span>(stokes.emm, <span class="st">"consec"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stokes.con, <span class="at">adjust=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate    SE df t.ratio p.value
 b - h      -1.286 0.166 20  -7.747  &lt;.0001
 p - b      -0.307 0.166 20  -1.850  0.0792

Results are averaged over the levels of: species 
Degrees-of-freedom method: kenward-roger </code></pre>
</div>
</div>
</section>
<section id="get-variance-components-with-cis" class="level3">
<h3 class="anchored" data-anchor-id="get-variance-components-with-cis">Get variance components with CIs</h3>
<div class="cell" data-hash="stokes_cache/html/unnamed-chunk-15_a56f540681e2e8b40e564873735387f1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>stokes.ci <span class="ot">&lt;-</span> <span class="fu">confint.merMod</span>(stokes.lmer)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>stokes.vc <span class="ot">&lt;-</span> (stokes.ci)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stokes.vc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              2.5 %     97.5 %
.sig01                   0.00000000 0.04989851
.sigma                   0.08975775 0.22735990
(Intercept)              1.33364907 3.11587298
speciesBkewense          0.37157920 0.06430639
segmentb                 2.58966474 0.55664060
segmentp                 3.80567534 1.18299122
speciesBkewense:segmentb 0.68464304 0.15465423
speciesBkewense:segmentp 0.57538799 0.21358195</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>